# vstu_xls
Parsing human-made Excel (.xls/.xlsx) sheets into machine-readable form.  
Main application of the configurable project is to deal with [VSTU's timetable files](https://www.vstu.ru/student/raspisaniya/zanyatiy/) (in Russian).

# Status / Статус
Some successful experiments. / Tcnm успешные эксперименты, в отладке 2D-парсер.

### Схема задания отступов внутренних и внешних компонентов паттерна
**Жирный** прямоугольник — это родительский 2D-паттерн, остальное — это его компоненты, которые ссылаются на другие паттерны с целью включить их в состав родительского паттерна.
![Отступы](https://github.com/den1s0v/vstu_xls/blob/main/materials/location-margins-paddings.png)

### Некоторые термины проекта

* Сетка - двумерное целочисленное координатное пространство.
* Ячейка - минимальная единица сетки, обладающая координатами и ненулевым размером (для случая объединённых ячеек размер более 1х1).
* Строковый шаблон - паттерн, включающий в себя регулярное выражение, который определяет тип контента ячейки по ее текстовому содержимому.
* Паттерн - 2D-шаблон некоторой структуры на сетке; может быть трёх видов: ячейка, структура, массив.
  * Паттерн-ячейка (cell) - одна “физическая” ячейка с контентом определённого типа.
  * Паттерн-структура (area) - одна или более ячеек, потенциально различных типов, объединенных паттерном; каждый компонент встречается в структуре только один раз.
  * Паттерн-массив (array) - одна или более ячеек одного типа (паттерна), расположенных близко друг к другу.
* Компонент структуры - ссылка на другой паттерн, который является частью структуры; может обладать ограничениями на позицию внутри родительской структуры (для внутренних компонентов), или вовне (для внешних компонентов).
* Область совпадения (match) - прямоугольник с известными координатами на сетке (координаты угла и длина+ширина), в котором обнаружен некоторый паттерн.
* Ограничения на положение (location) - набор отступов типа padding или margin в любом из четырёх направлений (left, top, right, bottom), каждый из которых может быть задан целым числом или диапазоном. 
* Диапазон (open_range) - интервал (два числа), обозначающий левую и правую границу (обе включительно), причём любая из них может быть бесконечной, то есть диапазон может быть открытым интервалом.
* Промежуток (gap) - диапазон допустимого расстояния между элементами массива.
* Направление расположения элементов массива (direction) - взаимное расположение элементов массива: row - ряд по горизонтали, column - ряд по вертикали, fill - область произвольной формы, где элементы расположены друг от друга на расстоянии не более заданного промежутка (gap).


### Средства

* [openpyxl](https://pypi.org/project/openpyxl/) и/или [xlrd](https://pypi.org/project/xlrd/) для извлечения информации о содержимом и форматировании ячеек, а также о стиле границ между ними
* [xls2xlsx](https://pypi.org/project/xls2xlsx/) для конвертации старого формата (Excel 2003) в новый (Excel 2007+) (НЕ COM (pywin32) + MS Excel, т.к. данные заменяются формулами)
* re (регулярные выражения) для классификации и разбора содержимого ячеек 

  
 
### Частичная структура проекта (наброски)
![Структура проекта](https://github.com/den1s0v/vstu_xls/blob/main/materials/О%20парсинге%20xls.png?raw=true)

